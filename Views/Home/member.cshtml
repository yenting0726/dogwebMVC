@{
    ViewData["Title"] = "Member Page";
}

<div class="text-center">
    <h1 class="display-4">使用者登入 / 註冊</h1>

    <div class="form-floating mb-3">
    <input name="Username" id="username" type="text" class="form-control" id="floatingUsername" placeholder="Username">
    <label for="floatingUsername">Username</label>
    </div>
<div class="form-floating mb-3">
  <input name="Password" id="password" type="password" class="form-control" id="floatingPassword" placeholder="Password">
  <label for="floatingPassword">Password</label>
</div>
<div class="form-floating mb-3">
  <input name="Email" id="email" type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
  <label for="floatingInput">Email address</label>
</div>



    <button id="btnLogin" class="btn btn-primary" type="submit">登入</button>
    <p class="mt-3">不是會員?</p>
    <button id="btnRegister" class="btn btn-success">加入會員</button>
    <button id="btnLogout" class="btn btn-danger">登出</button>


<p id="status" class="mt-3 text-info"></p>
</div>


<script>
    $(function () {
    // 登入
    $('#btnLogin').click(function (e) {
    e.preventDefault();
    

    const formData = new FormData();
    formData.append("Username", $('#username').val());
    formData.append("Password", $('#password').val());

    $.ajax({
        type: "POST",
        url: "/api/AuthApi/login",
        data: formData,
        processData: false,
        contentType: false,
        success: function (msg) {
            $('#status').text(msg.message || msg);
        },
        error: function (xhr) {
            $('#status').text("登入失敗：" + responseText);
        }
    });
});

    // 註冊
    $('#btnRegister').click(function (e) {
    e.preventDefault();

    const formData = new FormData();
    formData.append("Username", $('#username').val());
    formData.append("Password", $('#password').val());
    formData.append("Email", $('#email').val());

    $.ajax({
        type: "POST",
        url: "/api/AuthApi/register",
        data: formData,
        processData: false,
        contentType: false,
        success: function (msg) {
            $('#status').text(msg);
        },
        error: function (xhr) {
            $('#status').text("註冊失敗：" + xhr.responseText);
        }
    });
});

    // 登出
    $('#btnLogout').click(function () {
        $.post("/api/AuthApi/logout").done(function (msg) {
            $('#status').text(msg);
        });
    });

    // 檢查是否登入
    $.get("/api/AuthApi/check").done(function (msg) {
        
        if (msg == "未登入") {
            $('#status').text(msg);
        } 
        // check msg 中有 "已登入" 的話，則顯示登入狀態
        if (msg.includes("歡迎")) {
            $('#status').text("您已登入");
        }
    });
});
</script>